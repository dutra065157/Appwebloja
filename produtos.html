<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Catálogo de Produtos - Graça Presentes</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
    <link rel="stylesheet" href="styles/style.css">
</head>
<body class="text-gray-800 bg-white antialiased">
    <!-- Header -->
    <header class="gradient-bg shadow-sm sticky top-0 z-50 backdrop-blur-sm bg-white/95">
        <div class="container mx-auto px-4 py-3 flex justify-between items-center">
            <!-- Logo -->
            <div class="flex items-center">
                <div class="w-12 h-12 rounded-full bg-pink-100 flex items-center justify-center mr-3 transition-transform hover:scale-105">
                    <i data-feather="gift" class="text-pink-600 w-6 h-6"></i>
                </div>
                <h1 class="text-2xl font-bold text-pink-600 font-serif">Graça Presentes</h1>
            </div>
            
            <!-- Desktop Navigation -->
            <nav class="hidden lg:block">
                <ul class="flex space-x-8 items-center">
                    <li><a href="index.html" class="font-medium text-gray-600 hover:text-pink-600 transition-all duration-300 hover:border-b-2 hover:border-pink-600 pb-1">Home</a></li>
                    <li><a href="produtos.html" class="font-medium text-pink-600 border-b-2 border-pink-600 pb-1">Produtos</a></li>
                    
                </ul>
            </nav>
            
            <!-- Mobile Actions -->
            <div class="flex items-center space-x-3">
                <button class="p-2 rounded-full hover:bg-pink-50 transition-all duration-300" 
                        onclick="window.location.href='admin.html'" 
                        aria-label="Minha conta">
                    <i data-feather="user" class="w-5 h-5 text-gray-600"></i>
                </button>
                
                <button class="p-2 rounded-full hover:bg-pink-50 transition-all duration-300 relative" 
                        onclick="window.location.href='carrinho.html'" 
                        aria-label="Carrinho de compras">
                    <i data-feather="shopping-cart" class="w-5 h-5 text-gray-600"></i>
                    <span id="cart-count" class="absolute -top-1 -right-1 bg-pink-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center font-semibold">0</span>
                </button>
                
                <!-- Mobile Menu Button -->
                <button class="lg:hidden p-2 rounded-full hover:bg-pink-50 transition-all duration-300" 
                        id="mobile-menu-button"
                        aria-label="Abrir menu">
                    <i data-feather="menu" class="w-5 h-5 text-gray-600"></i>
                </button>
            </div>
        </div>
    </header>

    <!-- Mobile Menu -->
    <div id="mobile-menu" class="lg:hidden hidden bg-white/95 backdrop-blur-sm border-t border-gray-200">
        <ul class="flex flex-col p-4 space-y-3">
            <li>
                <a href="index.html" class="block py-2 px-3 rounded-md text-gray-700 font-medium hover:bg-pink-100 transition-colors">Home</a>
            </li>
            <li>
                <a href="produtos.html" class="block py-2 px-3 rounded-md text-gray-700 font-medium bg-pink-50 hover:bg-pink-100 transition-colors">Produtos</a>
            </li>
        </ul>
    </div>

    <!-- Product Catalog -->
    <main class="py-8">
        <div class="container mx-auto px-4">
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-8">
                <h1 class="text-3xl font-bold mb-4 md:mb-0">Nossos Produtos</h1>
                
                <div class="w-full md:w-auto flex flex-col md:flex-row space-y-4 md:space-y-0 md:space-x-4">
                    <div class="relative">
                        <input type="text" id="search-input" placeholder="Buscar produtos..." class="pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-pink-300 focus:border-transparent w-full md:w-64">
                        <i data-feather="search" class="absolute left-3 top-3 text-gray-400"></i>
                    </div>
                    
                    <div class="relative">
                        <select id="category-filter" class="appearance-none pl-3 pr-8 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-pink-300 focus:border-transparent w-full md:w-48">
                            <option value="">Todas Categorias</option>
                            <option value="Flores">Flores</option>
                            <option value="Doces">Doces</option>
                            <option value="Pelúcias">Pelúcias</option>
                            <option value="Cosméticos">Cosméticos</option>
                            <option value="Kits">Kits</option>
                            <option value="Decoração">Decoração</option>
                            <option value="Joias">Joias</option>
                        </select>
                        <i data-feather="chevron-down" class="absolute right-3 top-3 text-gray-400 pointer-events-none"></i>
                    </div>
                </div>
            </div>

            <!-- Loading State -->
            <div id="loading-state" class="text-center py-12">
                <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-pink-500 mx-auto mb-4"></div>
                <p class="text-gray-600">Carregando produtos...</p>
            </div>

            <!-- Error State -->
            <div id="error-state" class="text-center py-12 hidden">
                <i data-feather="alert-triangle" class="w-16 h-16 text-red-500 mx-auto mb-4"></i>
                <h3 class="text-xl font-bold text-gray-800 mb-2">Erro ao carregar produtos</h3>
                <p class="text-gray-600 mb-4" id="error-message"></p>
                <button onclick="carregarProdutos()" class="bg-pink-500 hover:bg-pink-600 text-white px-6 py-2 rounded-lg transition">
                    Tentar Novamente
                </button>
            </div>
            
            <!-- Products Grid -->
            <div id="products-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 hidden">
                <!-- Produtos serão carregados via JavaScript -->
            </div>

            <!-- Empty State -->
            <div id="empty-state" class="text-center py-12 hidden">
                <i data-feather="package" class="w-16 h-16 text-gray-300 mx-auto mb-4"></i>
                <h3 class="text-xl font-bold text-gray-600 mb-2">Nenhum produto encontrado</h3>
                <p class="text-gray-500">Tente ajustar os filtros ou buscar por outros termos.</p>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-gradient-to-b from-gray-900 to-gray-800 text-white pt-16 pb-8">
        <div class="container mx-auto px-4">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8 lg:gap-12">
                <!-- Brand -->
                <div class="lg:col-span-1">
                    <div class="flex items-center mb-6">
                        <div class="w-12 h-12 rounded-full bg-pink-500 flex items-center justify-center mr-3 shadow-lg">
                            <i data-feather="gift" class="text-white w-6 h-6"></i>
                        </div>
                        <h3 class="text-2xl font-bold font-serif">Graça Presentes</h3>
                    </div>
                    <p class="text-gray-300 mb-6 leading-relaxed">
                        Presentes especiais para momentos inesquecíveis desde 2010.
                    </p>
                    <div class="flex space-x-4">
                        <a href="#" class="w-10 h-10 bg-gray-700 hover:bg-pink-500 rounded-full flex items-center justify-center transition-all duration-300 transform hover:-translate-y-1 shadow-lg" aria-label="Facebook">
                            <i data-feather="facebook" class="w-4 h-4"></i>
                        </a>
                        <a href="#" class="w-10 h-10 bg-gray-700 hover:bg-pink-500 rounded-full flex items-center justify-center transition-all duration-300 transform hover:-translate-y-1 shadow-lg" aria-label="Instagram">
                            <i data-feather="instagram" class="w-4 h-4"></i>
                        </a>
                        <a href="#" class="w-10 h-10 bg-gray-700 hover:bg-pink-500 rounded-full flex items-center justify-center transition-all duration-300 transform hover:-translate-y-1 shadow-lg" aria-label="Twitter">
                            <i data-feather="twitter" class="w-4 h-4"></i>
                        </a>
                    </div>
                </div>

                <!-- Links Úteis -->
                <div>
                    <h4 class="font-bold text-lg mb-6 text-white border-b border-gray-700 pb-2">Links Úteis</h4>
                    <ul class="space-y-3">
                        <li><a href="#" class="text-gray-300 hover:text-pink-300 transition-all duration-300">Sobre Nós</a></li>
                        <li><a href="#" class="text-gray-300 hover:text-pink-300 transition-all duration-300">Blog</a></li>
                        <li><a href="#" class="text-gray-300 hover:text-pink-300 transition-all duration-300">Termos de Serviço</a></li>
                        <li><a href="#" class="text-gray-300 hover:text-pink-300 transition-all duration-300">Política de Privacidade</a></li>
                    </ul>
                </div>

                <!-- Contato -->
                <div>
                    <h4 class="font-bold text-lg mb-6 text-white border-b border-gray-700 pb-2">Contato</h4>
                    <ul class="space-y-4">
                        <li class="flex items-start">
                            <i data-feather="map-pin" class="mr-3 w-5 h-5 text-pink-400 mt-1 flex-shrink-0"></i>
                            <span class="text-gray-300">Rua das Flores, 123<br>São Paulo/SP</span>
                        </li>
                        <li class="flex items-center">
                            <i data-feather="phone" class="mr-3 w-5 h-5 text-pink-400"></i>
                            <span class="text-gray-300">(11) 9876-5432</span>
                        </li>
                    </ul>
                </div>
            </div>
            
            <div class="border-t border-gray-700 mt-12 pt-8 text-center text-gray-400">
                <p>&copy; 2024 Graça Presentes. Todos os direitos reservados.</p>
            </div>
        </div>
    </footer>

    <script src="js/app.js"></script>

    <script>
        // Classe Carrinho
        class Carrinho {
            constructor() {
                this.itens = JSON.parse(localStorage.getItem('carrinho')) || [];
                this.atualizarContador();
            }

            adicionarItem(produto) {
                const itemExistente = this.itens.find(item => item.id === produto.id);
                
                if (itemExistente) {
                    itemExistente.quantidade += 1;
                } else {
                    this.itens.push({
                        ...produto,
                        quantidade: 1
                    });
                }
                
                this.salvar();
                this.atualizarContador();
                this.mostrarFeedback(produto.nome);
            }

            atualizarContador() {
                const contador = document.getElementById('cart-count');
                const totalItens = this.itens.reduce((total, item) => total + item.quantidade, 0);
                contador.textContent = totalItens;
            }

            mostrarFeedback(nomeProduto) {
                const feedback = document.createElement('div');
                feedback.className = 'fixed top-4 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg z-50 animate-bounce';
                feedback.innerHTML = `
                    <div class="flex items-center">
                        <i data-feather="check-circle" class="w-5 h-5 mr-2"></i>
                        <span><strong>${nomeProduto}</strong> adicionado ao carrinho!</span>
                    </div>
                `;
                
                document.body.appendChild(feedback);
                feather.replace();
                
                setTimeout(() => feedback.remove(), 3000);
            }

            salvar() {
                localStorage.setItem('carrinho', JSON.stringify(this.itens));
            }
        }

        // Inicializar carrinho
        const carrinho = new Carrinho();
        let produtos = [];

        document.addEventListener('DOMContentLoaded', function() {
            carregarProdutos();
            feather.replace();
            
            // Filtros
            document.getElementById('search-input').addEventListener('input', filtrarProdutos);
            document.getElementById('category-filter').addEventListener('change', filtrarProdutos);
        });

        // Carregar produtos do backend
        async function carregarProdutos() {
            const loadingState = document.getElementById('loading-state');
            const errorState = document.getElementById('error-state');
            const productsGrid = document.getElementById('products-grid');
            const emptyState = document.getElementById('empty-state');

            loadingState.classList.remove('hidden');
            errorState.classList.add('hidden');
            productsGrid.classList.add('hidden');
            emptyState.classList.add('hidden');

            try {
                const response = await fetch('/api/produtos');
                
                if (!response.ok) throw new Error(`Erro ${response.status}`);
                
                produtos = await response.json();
                
                loadingState.classList.add('hidden');
                
                if (produtos.length === 0) {
                    emptyState.classList.remove('hidden');
                } else {
                    productsGrid.classList.remove('hidden');
                    renderizarProdutos(produtos);
                }
                
            } catch (error) {
                console.error('Erro ao carregar produtos:', error);
                loadingState.classList.add('hidden');
                errorState.classList.remove('hidden');
                document.getElementById('error-message').textContent = error.message;
            }
        }

        function renderizarProdutos(produtosParaRenderizar) {
            const container = document.getElementById('products-grid');
            
            container.innerHTML = produtosParaRenderizar.map(produto => {
                // Badges
                const badges = [];
                if (produto.desconto > 0) {
                    badges.push(`<div class="absolute top-3 left-3 bg-pink-500 text-white text-xs px-2 py-1 rounded-full font-semibold">-${produto.desconto}%</div>`);
                }
                if (produto.novo) {
                    badges.push(`<div class="absolute top-3 right-3 bg-green-500 text-white text-xs px-2 py-1 rounded-full font-semibold">Novo</div>`);
                }
                if (produto.maisVendido) {
                    badges.push(`<div class="absolute top-12 right-3 bg-orange-500 text-white text-xs px-2 py-1 rounded-full font-semibold">Mais Vendido</div>`);
                }

                // Preço com desconto
                const precoFinal = produto.desconto > 0 
                    ? produto.preco * (1 - produto.desconto / 100)
                    : produto.preco;

                // Mapear cores para classes seguras
                const corClasses = {
                    'pink': { bg: 'safe-bg-pink', text: 'safe-text-pink' },
                    'yellow': { bg: 'safe-bg-yellow', text: 'safe-text-yellow' },
                    'blue': { bg: 'safe-bg-blue', text: 'safe-text-blue' },
                    'purple': { bg: 'safe-bg-purple', text: 'safe-text-purple' },
                    'brown': { bg: 'safe-bg-amber', text: 'safe-text-amber' },
                    'gray': { bg: 'safe-bg-gray', text: 'safe-text-gray' },
                    'green': { bg: 'safe-bg-green', text: 'safe-text-green' },
                    'red': { bg: 'safe-bg-red', text: 'safe-text-red' }
                };
                
                const corClasse = corClasses[produto.cor] || corClasses['gray'];

                // Ícones por categoria
                const iconesCategoria = {
                    'Flores': 'flower',
                    'Doces': 'heart',
                    'Pelúcias': 'smile',
                    'Cosméticos': 'star',
                    'Kits': 'package',
                    'Decoração': 'home',
                    'Joias': 'award'
                };

                const icone = iconesCategoria[produto.categoria] || 'package';

                return `
                <div class="product-card bg-white rounded-xl overflow-hidden shadow-md hover:shadow-lg transition-all duration-300 fade-in" 
                     data-categoria="${produto.categoria}" 
                     data-nome="${produto.nome.toLowerCase()}">
                    <div class="relative h-48">
                        ${produto.imagem_url ? 
                            `<img src="${produto.imagem_url}" alt="${produto.nome}" class="w-full h-full object-cover">` :
                            `<div class="w-full h-full ${produto.corGradiente || 'bg-gradient-to-br from-gray-400 to-gray-600'} flex items-center justify-center">
                                <i data-feather="${icone}" class="w-16 h-16 text-white"></i>
                            </div>`
                        }
                        ${badges.join('')}
                    </div>
                    
                    <div class="p-4">
                        <div class="flex justify-between items-start mb-2">
                            <h3 class="font-semibold text-lg text-gray-800 truncate">${produto.nome}</h3>
                            <span class="${corClasse.bg} ${corClasse.text} text-xs px-2 py-1 rounded font-medium whitespace-nowrap ml-2">${produto.categoria}</span>
                        </div>
                        
                        <p class="text-gray-600 text-sm mb-4 leading-relaxed line-clamp-2">${produto.descricao || 'Produto de alta qualidade'}</p>
                        
                        <div class="flex justify-between items-center">
                            <div class="flex flex-col">
                                <span class="font-bold text-lg text-pink-500">R$ ${precoFinal.toFixed(2)}</span>
                                ${produto.precoOriginal && produto.precoOriginal > precoFinal ? 
                                    `<span class="text-xs text-gray-400 line-through">R$ ${produto.precoOriginal.toFixed(2)}</span>` : 
                                    ''}
                            </div>
                            <button class="add-to-cart-btn bg-pink-500 hover:bg-pink-600 text-white px-4 py-2 rounded-lg transition flex items-center space-x-2 font-medium"
                                    data-produto-id="${produto.id}">
                                <i data-feather="shopping-cart" class="w-4 h-4"></i>
                                <span>Adicionar</span>
                            </button>
                        </div>
                    </div>
                </div>
                `;
            }).join('');
            
            feather.replace();
            
            // Eventos dos botões
            document.querySelectorAll('.add-to-cart-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const produtoId = parseInt(this.getAttribute('data-produto-id'));
                    const produto = produtos.find(p => p.id === produtoId);
                    if (produto) {
                        carrinho.adicionarItem(produto);
                        
                        // Feedback visual
                        const originalHTML = this.innerHTML;
                        this.innerHTML = '<i data-feather="check" class="w-4 h-4"></i><span>Adicionado!</span>';
                        this.classList.remove('bg-pink-500', 'hover:bg-pink-600');
                        this.classList.add('bg-green-500');
                        feather.replace();
                        
                        setTimeout(() => {
                            this.innerHTML = originalHTML;
                            this.classList.remove('bg-green-500');
                            this.classList.add('bg-pink-500', 'hover:bg-pink-600');
                            feather.replace();
                        }, 2000);
                    }
                });
            });
        }

        function filtrarProdutos() {
            const termoBusca = document.getElementById('search-input').value.toLowerCase();
            const categoriaSelecionada = document.getElementById('category-filter').value;
            
            const produtosFiltrados = produtos.filter(produto => {
                const correspondeBusca = produto.nome.toLowerCase().includes(termoBusca) ||
                                       produto.descricao.toLowerCase().includes(termoBusca) ||
                                       produto.categoria.toLowerCase().includes(termoBusca);
                
                const correspondeCategoria = !categoriaSelecionada || produto.categoria === categoriaSelecionada;
                
                return correspondeBusca && correspondeCategoria;
            });
            
            const container = document.getElementById('products-grid');
            const emptyState = document.getElementById('empty-state');
            
            if (produtosFiltrados.length === 0) {
                container.classList.add('hidden');
                emptyState.classList.remove('hidden');
            } else {
                container.classList.remove('hidden');
                emptyState.classList.add('hidden');
                renderizarProdutos(produtosFiltrados);
            }
        }
    </script>
</body>
</html>